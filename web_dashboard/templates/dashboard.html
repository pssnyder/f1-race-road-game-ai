<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèéÔ∏è F1 Race AI Training Dashboard</title>
    <style>
        :root {
            --primary-color: #2ecc71;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --info-color: #3498db;
            --dark-bg: #2c3e50;
            --light-bg: #ecf0f1;
            --card-bg: #ffffff;
            --text-dark: #2c3e50;
            --text-light: #7f8c8d;
            --border-color: #bdc3c7;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--light-bg) 0%, #d5dbdb 100%);
            color: var(--text-dark);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--card-bg);
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: var(--dark-bg);
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: var(--text-light);
            font-size: 1.2em;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--card-bg);
            padding: 15px 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .status-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .status-value {
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .status-label {
            color: var(--text-light);
            font-size: 0.9em;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
        }

        .card h2 {
            color: var(--dark-bg);
            margin-bottom: 20px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chart-container {
            grid-column: 1 / -1;
            text-align: center;
        }

        .chart-container img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: var(--light-bg);
            border-radius: 10px;
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: var(--info-color);
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--text-light);
            font-size: 0.9em;
        }

        .models-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .model-item {
            display: flex;
            justify-content: between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .model-item:last-child {
            border-bottom: none;
        }

        .model-info {
            flex-grow: 1;
        }

        .model-name {
            font-weight: bold;
            color: var(--text-dark);
            margin-bottom: 3px;
        }

        .model-details {
            color: var(--text-light);
            font-size: 0.85em;
        }

        .model-badge {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.7em;
            font-weight: bold;
            text-transform: uppercase;
        }

        .badge-final {
            background: var(--primary-color);
            color: white;
        }

        .badge-checkpoint {
            background: var(--warning-color);
            color: white;
        }

        .status-active {
            color: var(--primary-color);
        }

        .status-idle {
            color: var(--text-light);
        }

        .loading {
            text-align: center;
            color: var(--text-light);
            font-style: italic;
        }

        .chart-placeholder {
            background: var(--light-bg);
            border-radius: 10px;
            padding: 60px 20px;
            text-align: center;
            color: var(--text-light);
            border: 2px dashed var(--border-color);
        }

        .refresh-indicator {
            display: inline-block;
            font-size: 0.8em;
            color: var(--text-light);
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .spinning {
            animation: spin 1s linear infinite;
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            color: var(--text-light);
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }

            .status-bar {
                flex-direction: column;
                gap: 15px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üèéÔ∏è F1 Race AI Training Dashboard</h1>
            <p>Real-time monitoring of your AI race car driver's learning progress</p>
        </header>

        <div class="status-bar">
            <div class="status-item">
                <div class="status-value" id="training-status">üîÑ Loading...</div>
                <div class="status-label">Training Status</div>
            </div>
            <div class="status-item">
                <div class="status-value" id="uptime">--</div>
                <div class="status-label">Dashboard Uptime</div>
            </div>
            <div class="status-item">
                <div class="status-value" id="last-update">--</div>
                <div class="status-label">Last Update</div>
            </div>
            <div class="refresh-indicator">
                <span id="refresh-icon">üîÑ</span>
                <span id="refresh-text">Auto-refresh every 5s</span>
            </div>
        </div>

        <div class="grid">
            <div class="card">
                <h2>üìä Training Statistics</h2>
                <div class="stats-grid" id="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="total-episodes">--</div>
                        <div class="stat-label">Total Episodes</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="best-score">--</div>
                        <div class="stat-label">Best Score</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="avg-score">--</div>
                        <div class="stat-label">Average Score</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="recent-avg">--</div>
                        <div class="stat-label">Recent Avg</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="exploration-rate">--</div>
                        <div class="stat-label">Exploration Rate</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="training-loss">--</div>
                        <div class="stat-label">Recent Loss</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>üíæ Recent Models</h2>
                <div class="models-list" id="models-list">
                    <div class="loading">Loading model information...</div>
                </div>
            </div>

            <div class="card chart-container">
                <h2>üìà Training Progress Chart</h2>
                <div id="chart-container">
                    <div class="chart-placeholder">
                        <h3>üìä Training Chart</h3>
                        <p>Chart will appear here once training begins</p>
                        <p style="margin-top: 10px; font-size: 0.9em;">Start training with: <code>python train_ai.py</code></p>
                    </div>
                </div>
            </div>
        </div>

        <footer class="footer">
            <p>ü§ñ F1 Race AI Training Dashboard ‚Ä¢ Built with ‚ù§Ô∏è for AI education ‚Ä¢ Updates automatically every 5 seconds</p>
        </footer>
    </div>

    <script>
        let refreshInterval;
        let lastChartUpdate = '';

        function formatNumber(num) {
            if (num === null || num === undefined || num === '--') return '--';
            if (typeof num === 'number') {
                return num.toLocaleString(undefined, {maximumFractionDigits: 2});
            }
            return num;
        }

        function updateStats(modelStats) {
            if (!modelStats) {
                // Set all stats to loading state
                document.getElementById('total-episodes').textContent = '--';
                document.getElementById('best-score').textContent = '--';
                document.getElementById('avg-score').textContent = '--';
                document.getElementById('recent-avg').textContent = '--';
                document.getElementById('exploration-rate').textContent = '--';
                document.getElementById('training-loss').textContent = '--';
                return;
            }

            document.getElementById('total-episodes').textContent = formatNumber(modelStats.total_episodes);
            document.getElementById('best-score').textContent = formatNumber(modelStats.best_score);
            document.getElementById('avg-score').textContent = formatNumber(modelStats.average_score);
            document.getElementById('recent-avg').textContent = formatNumber(modelStats.recent_average);
            
            if (typeof modelStats.current_epsilon === 'number') {
                document.getElementById('exploration-rate').textContent = (modelStats.current_epsilon * 100).toFixed(1) + '%';
            } else {
                document.getElementById('exploration-rate').textContent = '--';
            }

            if (modelStats.training_losses && modelStats.training_losses.length > 0) {
                const recentLoss = modelStats.training_losses.slice(-1)[0];
                document.getElementById('training-loss').textContent = formatNumber(recentLoss);
            } else {
                document.getElementById('training-loss').textContent = '--';
            }
        }

        function updateModels(models) {
            const container = document.getElementById('models-list');
            
            if (!models || models.length === 0) {
                container.innerHTML = '<div class="loading">No models found yet. Start training to see models!</div>';
                return;
            }

            let html = '';
            models.forEach(model => {
                const badgeClass = model.type === 'final' ? 'badge-final' : 'badge-checkpoint';
                html += `
                    <div class="model-item">
                        <div class="model-info">
                            <div class="model-name">${model.name}</div>
                            <div class="model-details">${model.size} ‚Ä¢ ${model.last_updated}</div>
                        </div>
                        <span class="model-badge ${badgeClass}">${model.type}</span>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function updateChart(chartInfo) {
            const container = document.getElementById('chart-container');
            
            if (!chartInfo.exists) {
                container.innerHTML = `
                    <div class="chart-placeholder">
                        <h3>üìä Training Chart</h3>
                        <p>${chartInfo.message}</p>
                        <p style="margin-top: 10px; font-size: 0.9em;">Start training with: <code>python train_ai.py</code></p>
                    </div>
                `;
                return;
            }

            // Only update if chart has changed
            if (chartInfo.last_updated !== lastChartUpdate) {
                lastChartUpdate = chartInfo.last_updated;
                container.innerHTML = `
                    <img src="${chartInfo.url}" alt="Training Progress Chart" />
                    <p style="margin-top: 10px; color: #7f8c8d; font-size: 0.9em;">
                        Last updated: ${chartInfo.last_updated} ‚Ä¢ Size: ${chartInfo.size}
                    </p>
                `;
            }
        }

        function fetchStatus() {
            const refreshIcon = document.getElementById('refresh-icon');
            refreshIcon.classList.add('spinning');

            fetch('/api/status')
                .then(response => response.json())
                .then(data => {
                    // Update status
                    const statusElement = document.getElementById('training-status');
                    statusElement.textContent = data.status.status;
                    statusElement.className = data.status.active ? 'status-value status-active' : 'status-value status-idle';
                    
                    document.getElementById('uptime').textContent = data.status.uptime;
                    document.getElementById('last-update').textContent = data.timestamp;

                    // Update statistics
                    updateStats(data.model_stats);

                    // Update models
                    updateModels(data.models);

                    // Update chart
                    updateChart(data.chart);
                })
                .catch(error => {
                    console.error('Error fetching status:', error);
                    document.getElementById('training-status').textContent = '‚ùå Connection Error';
                })
                .finally(() => {
                    refreshIcon.classList.remove('spinning');
                });
        }

        // Initialize
        function init() {
            fetchStatus(); // Initial load
            refreshInterval = setInterval(fetchStatus, 5000); // Update every 5 seconds
        }

        // Start when page loads
        document.addEventListener('DOMContentLoaded', init);

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
        });
    </script>
</body>
</html>